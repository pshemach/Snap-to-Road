<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
    
            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <style>
                #map_89d2dcf4a2a96861c58f679fcba05969 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
</head>
<body>
    
    
            <div class="folium-map" id="map_89d2dcf4a2a96861c58f679fcba05969" ></div>
        
</body>
<script>
    
    
            var map_89d2dcf4a2a96861c58f679fcba05969 = L.map(
                "map_89d2dcf4a2a96861c58f679fcba05969",
                {
                    center: [6.140257008748951, 80.09975399730918],
                    crs: L.CRS.EPSG3857,
                    zoom: 16,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_359b3ed4ba4961256a31168e27b3df25 = L.tileLayer(
                "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                {"attribution": "Data by \u0026copy; \u003ca target=\"_blank\" href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca target=\"_blank\" href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            ).addTo(map_89d2dcf4a2a96861c58f679fcba05969);
        
    
            var poly_line_351ce0e7bd2e2758ebc024528e825995 = L.polyline(
                [[6.14026, 80.09975], [6.14173, 80.09953], [6.14285, 80.09979], [6.14374, 80.09975], [6.14449, 80.09917], [6.14652, 80.09942], [6.14725, 80.09949], [6.14801, 80.09916], [6.14937, 80.09857], [6.15109, 80.09735], [6.15316, 80.09585], [6.15477, 80.09508], [6.15535, 80.09477], [6.15597, 80.09389], [6.15644, 80.09291], [6.15687, 80.09256], [6.15826, 80.09215], [6.16072, 80.09162], [6.16301, 80.09103], [6.16457, 80.09041], [6.16632, 80.08954], [6.16768, 80.08865], [6.16901, 80.08726], [6.17067, 80.08595], [6.17267, 80.08405], [6.17575, 80.08046], [6.17698, 80.07904], [6.17863, 80.07752], [6.18386, 80.07149], [6.18759, 80.06727], [6.18861, 80.06643], [6.18961, 80.06529], [6.19086, 80.06372], [6.19161, 80.06313], [6.19357, 80.06229], [6.19451, 80.06218], [6.19559, 80.06254], [6.1974, 80.06344], [6.1989, 80.06405], [6.20057, 80.06414], [6.20277, 80.06394], [6.20503, 80.06334], [6.20861, 80.06175], [6.21166, 80.06019], [6.21496, 80.05896], [6.21649, 80.05832], [6.21815, 80.05792], [6.21987, 80.05751], [6.22237, 80.05651], [6.22606, 80.05463], [6.2269, 80.05426], [6.22789, 80.05442], [6.22863, 80.05443], [6.22993, 80.05416], [6.23384, 80.05443], [6.23713, 80.0543], [6.23965, 80.05395], [6.24095, 80.05352], [6.24156, 80.05254], [6.24175, 80.05176], [6.24153, 80.05055], [6.24198, 80.04985], [6.24244, 80.04921], [6.24324, 80.04864], [6.2443, 80.04779], [6.24506, 80.04707], [6.24612, 80.04625], [6.24725, 80.04494], [6.2485, 80.0444], [6.25002, 80.04346], [6.25129, 80.0427], [6.2531, 80.04148], [6.25566, 80.03972], [6.2567, 80.03899], [6.25782, 80.03781], [6.25827, 80.03761], [6.25874, 80.03769], [6.26041, 80.03761], [6.26093, 80.03767], [6.26176, 80.03744], [6.26396, 80.03663], [6.26593, 80.0354], [6.26686, 80.03517], [6.26753, 80.03533], [6.26955, 80.03751], [6.27027, 80.03785], [6.27112, 80.03781], [6.27154, 80.03809], [6.27242, 80.0393], [6.27272, 80.03939], [6.27341, 80.03912], [6.27428, 80.03886], [6.27558, 80.03918], [6.27792, 80.0399], [6.27876, 80.04037], [6.27968, 80.0404], [6.28164, 80.04077], [6.28556, 80.04111], [6.28741, 80.04154], [6.28849, 80.04117], [6.2894, 80.04114], [6.29118, 80.04094], [6.29383, 80.04131], [6.29605, 80.04066], [6.2975, 80.04009], [6.29884, 80.03973], [6.29933, 80.03945], [6.29997, 80.03871], [6.3013, 80.03869], [6.30214, 80.0387], [6.30369, 80.03847], [6.30449, 80.03833], [6.30541, 80.03771], [6.3066, 80.03681], [6.3073, 80.03521], [6.30755, 80.03482], [6.30816, 80.0345], [6.3102, 80.03433], [6.31144, 80.03469], [6.31247, 80.03484], [6.31382, 80.03511], [6.31539, 80.03474], [6.31625, 80.03419], [6.31853, 80.03292], [6.32018, 80.03224], [6.32068, 80.03227], [6.32101, 80.03257], [6.32181, 80.03411], [6.32216, 80.03425], [6.32403, 80.03417], [6.32838, 80.03312], [6.33374, 80.03124], [6.33852, 80.02891], [6.34016, 80.0275], [6.34206, 80.02626], [6.34464, 80.02524], [6.34524, 80.02487], [6.34617, 80.02372], [6.34782, 80.0224], [6.34933, 80.02161], [6.35052, 80.02093], [6.35125, 80.01979], [6.3516, 80.01943], [6.35328, 80.01879], [6.35584, 80.01783], [6.35747, 80.01678], [6.35992, 80.01597], [6.36476, 80.01345], [6.36673, 80.01236], [6.36798, 80.01191], [6.37015, 80.01165], [6.37298, 80.01091], [6.37488, 80.01001], [6.37636, 80.00956], [6.37748, 80.01005], [6.37886, 80.01027], [6.38461, 80.00928], [6.38651, 80.00875], [6.39093, 80.00704], [6.3934, 80.00604], [6.39484, 80.00583], [6.39657, 80.00601], [6.39842, 80.00565], [6.40079, 80.00485], [6.40271, 80.00401], [6.40559, 80.00279], [6.40727, 80.00213], [6.41052, 80.00108], [6.41265, 80.00068], [6.41476, 80.00125], [6.41726, 80.00206], [6.41916, 80.00248], [6.42086, 80.00214], [6.42177, 80.00173], [6.42277, 80.00023], [6.42298, 79.99886], [6.42349, 79.99815], [6.42419, 79.99777], [6.42553, 79.99771], [6.42707, 79.99811], [6.4284, 79.99874], [6.42989, 79.99961], [6.43065, 79.99942], [6.43167, 79.99887], [6.43243, 80.0001], [6.43329, 80.00006], [6.43347, 80.00005], [6.43332, 79.99958], [6.43322, 79.99933], [6.43301, 79.9988], [6.4328, 79.99829], [6.43324, 79.99805], [6.43443, 79.99739], [6.43504, 79.997], [6.43603, 79.99637], [6.43742, 79.9955], [6.44162, 79.99288], [6.44647, 79.98967], [6.44947, 79.98749], [6.45135, 79.98645], [6.45523, 79.98517], [6.45578, 79.98509], [6.45645, 79.98546], [6.4576, 79.98673], [6.45815, 79.98695], [6.46228, 79.98712], [6.46435, 79.98721], [6.4656, 79.98697], [6.47181, 79.98472], [6.47681, 79.98292], [6.47915, 79.98318], [6.4833, 79.98341], [6.48783, 79.98312], [6.4893, 79.9826], [6.49178, 79.98218], [6.49488, 79.98151], [6.49866, 79.98078], [6.49998, 79.97989], [6.50165, 79.9799], [6.50262, 79.98019], [6.50428, 79.98092], [6.50657, 79.98103], [6.51015, 79.98211], [6.51078, 79.9821], [6.51191, 79.98169], [6.51478, 79.98053], [6.51634, 79.98039], [6.51915, 79.97936], [6.52056, 79.97904], [6.5219, 79.97976], [6.52264, 79.97994], [6.52419, 79.97965], [6.53218, 79.97731], [6.53587, 79.97624], [6.54002, 79.97493], [6.54276, 79.97423], [6.54451, 79.97383], [6.54702, 79.973], [6.55083, 79.97153], [6.55413, 79.97007], [6.55902, 79.96925], [6.56138, 79.96887], [6.56505, 79.96777], [6.56939, 79.96614], [6.57346, 79.96424], [6.57753, 79.96287], [6.5784, 79.96267], [6.58132, 79.96164], [6.58512, 79.96061], [6.58538, 79.96052], [6.58582, 79.96026], [6.58658, 79.95978], [6.58759, 79.95969], [6.59318, 79.95919], [6.59507, 79.95893], [6.59644, 79.95878], [6.59765, 79.95825], [6.59992, 79.95678], [6.60284, 79.95517], [6.60836, 79.95253], [6.61216, 79.95009], [6.614, 79.94903], [6.61598, 79.9482], [6.618, 79.94764], [6.62064, 79.94651], [6.62244, 79.94552], [6.62526, 79.94416], [6.62946, 79.94293], [6.6373, 79.93994], [6.64, 79.93892], [6.64059, 79.93906], [6.64164, 79.93932], [6.64283, 79.93876], [6.64428, 79.93817], [6.6459, 79.93703], [6.64699, 79.93657], [6.64819, 79.93661], [6.64887, 79.9365], [6.65021, 79.93584], [6.65217, 79.93527], [6.65571, 79.9343], [6.65667, 79.93424], [6.65743, 79.93391], [6.66107, 79.932], [6.66645, 79.92916], [6.66876, 79.92825], [6.67027, 79.92737], [6.67203, 79.92677], [6.67314, 79.926], [6.67406, 79.92522], [6.67564, 79.92434], [6.67766, 79.92327], [6.6795, 79.92239], [6.68404, 79.92013], [6.6892, 79.91744], [6.69292, 79.91561], [6.69475, 79.91437], [6.69716, 79.91328], [6.70029, 79.9123], [6.70086, 79.91197], [6.70196, 79.91077], [6.70371, 79.91], [6.70582, 79.90898], [6.70819, 79.90827], [6.71057, 79.90746], [6.71142, 79.90701], [6.71243, 79.90634], [6.7122, 79.90587], [6.71195, 79.9055], [6.7119, 79.90493], [6.71189, 79.90521], [6.71208, 79.90575], [6.7123, 79.90602], [6.71243, 79.90634], [6.71275, 79.90608], [6.71365, 79.90532], [6.71383, 79.9058], [6.71416, 79.90749], [6.71367, 79.90757], [6.71232, 79.90755], [6.71075, 79.90752], [6.71044, 79.90756], [6.71044, 79.90756], [6.71009, 79.90766], [6.70981, 79.90776], [6.70979, 79.90777]],
                {"bubblingMouseEvents": true, "color": "blue", "dashArray": null, "dashOffset": null, "fill": false, "fillColor": "blue", "fillOpacity": 0.2, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "noClip": false, "opacity": 0.6, "smoothFactor": 1.0, "stroke": true, "weight": 4}
            ).addTo(map_89d2dcf4a2a96861c58f679fcba05969);
        
    
            var circle_marker_f3060ed415de06d27c5360d2ab77a477 = L.circleMarker(
                [6.14264, 80.10011],
                {"bubblingMouseEvents": true, "color": "orange", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "orange", "fillOpacity": 0.7, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 8, "stroke": true, "weight": 3}
            ).addTo(map_89d2dcf4a2a96861c58f679fcba05969);
        
    
        var popup_5b1b3d6a6170ab87c443a9a563410669 = L.popup({"maxWidth": "100%"});

        
            
                var html_60311cf66dd6800a482221359c192dbc = $(`<div id="html_60311cf66dd6800a482221359c192dbc" style="width: 100.0%; height: 100.0%;">Hikkaduwa FC Duration: 2.53 min</div>`)[0];
                popup_5b1b3d6a6170ab87c443a9a563410669.setContent(html_60311cf66dd6800a482221359c192dbc);
            
        

        circle_marker_f3060ed415de06d27c5360d2ab77a477.bindPopup(popup_5b1b3d6a6170ab87c443a9a563410669)
        ;

        
    
    
            var circle_marker_30c543be060865c804279f08bc12c6bc = L.circleMarker(
                [6.43296, 80.00011],
                {"bubblingMouseEvents": true, "color": "orange", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "orange", "fillOpacity": 0.7, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 8, "stroke": true, "weight": 3}
            ).addTo(map_89d2dcf4a2a96861c58f679fcba05969);
        
    
        var popup_a64988ffeacc2a780586f63eae7099df = L.popup({"maxWidth": "100%"});

        
            
                var html_36f3bdfb08ec08e0f96143483d8bc550 = $(`<div id="html_36f3bdfb08ec08e0f96143483d8bc550" style="width: 100.0%; height: 100.0%;">Aluthgama FC Duration: 9.08 min</div>`)[0];
                popup_a64988ffeacc2a780586f63eae7099df.setContent(html_36f3bdfb08ec08e0f96143483d8bc550);
            
        

        circle_marker_30c543be060865c804279f08bc12c6bc.bindPopup(popup_a64988ffeacc2a780586f63eae7099df)
        ;

        
    
    
            var circle_marker_0dcf777217558c6bcf4abd960d265366 = L.circleMarker(
                [6.70941, 79.90764],
                {"bubblingMouseEvents": true, "color": "orange", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "orange", "fillOpacity": 0.7, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 8, "stroke": true, "weight": 3}
            ).addTo(map_89d2dcf4a2a96861c58f679fcba05969);
        
    
        var popup_222fcdfef5043ee6a71352256d52d494 = L.popup({"maxWidth": "100%"});

        
            
                var html_8bde93a85c27dc283b48b849d715b473 = $(`<div id="html_8bde93a85c27dc283b48b849d715b473" style="width: 100.0%; height: 100.0%;">Panadura FC Duration: 27.35 min</div>`)[0];
                popup_222fcdfef5043ee6a71352256d52d494.setContent(html_8bde93a85c27dc283b48b849d715b473);
            
        

        circle_marker_0dcf777217558c6bcf4abd960d265366.bindPopup(popup_222fcdfef5043ee6a71352256d52d494)
        ;

        
    
</script>
</html>
<div id='controls' style="position:absolute; bottom:20px; left:20px; background:white; padding:10px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.2); z-index:1000">
  <button onclick="play()">▶️ Play</button>
  <button onclick="pause()">⏸ Pause</button>
  <label>Speed: <input type="range" min="0.5" max="3" value="1" step="0.1" id="speedSlider"></label>
  <input id="progressBar" type="range" min="0" max="325" value="0" style="width:100%;">
</div>
<script>
const route = [[6.14026, 80.09975], [6.14173, 80.09953], [6.14285, 80.09979], [6.14374, 80.09975], [6.14449, 80.09917], [6.14652, 80.09942], [6.14725, 80.09949], [6.14801, 80.09916], [6.14937, 80.09857], [6.15109, 80.09735], [6.15316, 80.09585], [6.15477, 80.09508], [6.15535, 80.09477], [6.15597, 80.09389], [6.15644, 80.09291], [6.15687, 80.09256], [6.15826, 80.09215], [6.16072, 80.09162], [6.16301, 80.09103], [6.16457, 80.09041], [6.16632, 80.08954], [6.16768, 80.08865], [6.16901, 80.08726], [6.17067, 80.08595], [6.17267, 80.08405], [6.17575, 80.08046], [6.17698, 80.07904], [6.17863, 80.07752], [6.18386, 80.07149], [6.18759, 80.06727], [6.18861, 80.06643], [6.18961, 80.06529], [6.19086, 80.06372], [6.19161, 80.06313], [6.19357, 80.06229], [6.19451, 80.06218], [6.19559, 80.06254], [6.1974, 80.06344], [6.1989, 80.06405], [6.20057, 80.06414], [6.20277, 80.06394], [6.20503, 80.06334], [6.20861, 80.06175], [6.21166, 80.06019], [6.21496, 80.05896], [6.21649, 80.05832], [6.21815, 80.05792], [6.21987, 80.05751], [6.22237, 80.05651], [6.22606, 80.05463], [6.2269, 80.05426], [6.22789, 80.05442], [6.22863, 80.05443], [6.22993, 80.05416], [6.23384, 80.05443], [6.23713, 80.0543], [6.23965, 80.05395], [6.24095, 80.05352], [6.24156, 80.05254], [6.24175, 80.05176], [6.24153, 80.05055], [6.24198, 80.04985], [6.24244, 80.04921], [6.24324, 80.04864], [6.2443, 80.04779], [6.24506, 80.04707], [6.24612, 80.04625], [6.24725, 80.04494], [6.2485, 80.0444], [6.25002, 80.04346], [6.25129, 80.0427], [6.2531, 80.04148], [6.25566, 80.03972], [6.2567, 80.03899], [6.25782, 80.03781], [6.25827, 80.03761], [6.25874, 80.03769], [6.26041, 80.03761], [6.26093, 80.03767], [6.26176, 80.03744], [6.26396, 80.03663], [6.26593, 80.0354], [6.26686, 80.03517], [6.26753, 80.03533], [6.26955, 80.03751], [6.27027, 80.03785], [6.27112, 80.03781], [6.27154, 80.03809], [6.27242, 80.0393], [6.27272, 80.03939], [6.27341, 80.03912], [6.27428, 80.03886], [6.27558, 80.03918], [6.27792, 80.0399], [6.27876, 80.04037], [6.27968, 80.0404], [6.28164, 80.04077], [6.28556, 80.04111], [6.28741, 80.04154], [6.28849, 80.04117], [6.2894, 80.04114], [6.29118, 80.04094], [6.29383, 80.04131], [6.29605, 80.04066], [6.2975, 80.04009], [6.29884, 80.03973], [6.29933, 80.03945], [6.29997, 80.03871], [6.3013, 80.03869], [6.30214, 80.0387], [6.30369, 80.03847], [6.30449, 80.03833], [6.30541, 80.03771], [6.3066, 80.03681], [6.3073, 80.03521], [6.30755, 80.03482], [6.30816, 80.0345], [6.3102, 80.03433], [6.31144, 80.03469], [6.31247, 80.03484], [6.31382, 80.03511], [6.31539, 80.03474], [6.31625, 80.03419], [6.31853, 80.03292], [6.32018, 80.03224], [6.32068, 80.03227], [6.32101, 80.03257], [6.32181, 80.03411], [6.32216, 80.03425], [6.32403, 80.03417], [6.32838, 80.03312], [6.33374, 80.03124], [6.33852, 80.02891], [6.34016, 80.0275], [6.34206, 80.02626], [6.34464, 80.02524], [6.34524, 80.02487], [6.34617, 80.02372], [6.34782, 80.0224], [6.34933, 80.02161], [6.35052, 80.02093], [6.35125, 80.01979], [6.3516, 80.01943], [6.35328, 80.01879], [6.35584, 80.01783], [6.35747, 80.01678], [6.35992, 80.01597], [6.36476, 80.01345], [6.36673, 80.01236], [6.36798, 80.01191], [6.37015, 80.01165], [6.37298, 80.01091], [6.37488, 80.01001], [6.37636, 80.00956], [6.37748, 80.01005], [6.37886, 80.01027], [6.38461, 80.00928], [6.38651, 80.00875], [6.39093, 80.00704], [6.3934, 80.00604], [6.39484, 80.00583], [6.39657, 80.00601], [6.39842, 80.00565], [6.40079, 80.00485], [6.40271, 80.00401], [6.40559, 80.00279], [6.40727, 80.00213], [6.41052, 80.00108], [6.41265, 80.00068], [6.41476, 80.00125], [6.41726, 80.00206], [6.41916, 80.00248], [6.42086, 80.00214], [6.42177, 80.00173], [6.42277, 80.00023], [6.42298, 79.99886], [6.42349, 79.99815], [6.42419, 79.99777], [6.42553, 79.99771], [6.42707, 79.99811], [6.4284, 79.99874], [6.42989, 79.99961], [6.43065, 79.99942], [6.43167, 79.99887], [6.43243, 80.0001], [6.43329, 80.00006], [6.43347, 80.00005], [6.43332, 79.99958], [6.43322, 79.99933], [6.43301, 79.9988], [6.4328, 79.99829], [6.43324, 79.99805], [6.43443, 79.99739], [6.43504, 79.997], [6.43603, 79.99637], [6.43742, 79.9955], [6.44162, 79.99288], [6.44647, 79.98967], [6.44947, 79.98749], [6.45135, 79.98645], [6.45523, 79.98517], [6.45578, 79.98509], [6.45645, 79.98546], [6.4576, 79.98673], [6.45815, 79.98695], [6.46228, 79.98712], [6.46435, 79.98721], [6.4656, 79.98697], [6.47181, 79.98472], [6.47681, 79.98292], [6.47915, 79.98318], [6.4833, 79.98341], [6.48783, 79.98312], [6.4893, 79.9826], [6.49178, 79.98218], [6.49488, 79.98151], [6.49866, 79.98078], [6.49998, 79.97989], [6.50165, 79.9799], [6.50262, 79.98019], [6.50428, 79.98092], [6.50657, 79.98103], [6.51015, 79.98211], [6.51078, 79.9821], [6.51191, 79.98169], [6.51478, 79.98053], [6.51634, 79.98039], [6.51915, 79.97936], [6.52056, 79.97904], [6.5219, 79.97976], [6.52264, 79.97994], [6.52419, 79.97965], [6.53218, 79.97731], [6.53587, 79.97624], [6.54002, 79.97493], [6.54276, 79.97423], [6.54451, 79.97383], [6.54702, 79.973], [6.55083, 79.97153], [6.55413, 79.97007], [6.55902, 79.96925], [6.56138, 79.96887], [6.56505, 79.96777], [6.56939, 79.96614], [6.57346, 79.96424], [6.57753, 79.96287], [6.5784, 79.96267], [6.58132, 79.96164], [6.58512, 79.96061], [6.58538, 79.96052], [6.58582, 79.96026], [6.58658, 79.95978], [6.58759, 79.95969], [6.59318, 79.95919], [6.59507, 79.95893], [6.59644, 79.95878], [6.59765, 79.95825], [6.59992, 79.95678], [6.60284, 79.95517], [6.60836, 79.95253], [6.61216, 79.95009], [6.614, 79.94903], [6.61598, 79.9482], [6.618, 79.94764], [6.62064, 79.94651], [6.62244, 79.94552], [6.62526, 79.94416], [6.62946, 79.94293], [6.6373, 79.93994], [6.64, 79.93892], [6.64059, 79.93906], [6.64164, 79.93932], [6.64283, 79.93876], [6.64428, 79.93817], [6.6459, 79.93703], [6.64699, 79.93657], [6.64819, 79.93661], [6.64887, 79.9365], [6.65021, 79.93584], [6.65217, 79.93527], [6.65571, 79.9343], [6.65667, 79.93424], [6.65743, 79.93391], [6.66107, 79.932], [6.66645, 79.92916], [6.66876, 79.92825], [6.67027, 79.92737], [6.67203, 79.92677], [6.67314, 79.926], [6.67406, 79.92522], [6.67564, 79.92434], [6.67766, 79.92327], [6.6795, 79.92239], [6.68404, 79.92013], [6.6892, 79.91744], [6.69292, 79.91561], [6.69475, 79.91437], [6.69716, 79.91328], [6.70029, 79.9123], [6.70086, 79.91197], [6.70196, 79.91077], [6.70371, 79.91], [6.70582, 79.90898], [6.70819, 79.90827], [6.71057, 79.90746], [6.71142, 79.90701], [6.71243, 79.90634], [6.7122, 79.90587], [6.71195, 79.9055], [6.7119, 79.90493], [6.71189, 79.90521], [6.71208, 79.90575], [6.7123, 79.90602], [6.71243, 79.90634], [6.71275, 79.90608], [6.71365, 79.90532], [6.71383, 79.9058], [6.71416, 79.90749], [6.71367, 79.90757], [6.71232, 79.90755], [6.71075, 79.90752], [6.71044, 79.90756], [6.71044, 79.90756], [6.71009, 79.90766], [6.70981, 79.90776], [6.70979, 79.90777]];
const visits = [{'shop': 'Hikkaduwa FC', 'lat': 6.14264, 'lng': 80.10011, 'duration_min': 2.53, 'check_in': '01:55', 'check_out': '01:57'}, {'shop': 'Aluthgama FC', 'lat': 6.43296, 'lng': 80.00011, 'duration_min': 9.08, 'check_in': '02:30', 'check_out': '02:39'}, {'shop': 'Panadura FC', 'lat': 6.70941, 'lng': 79.90764, 'duration_min': 27.35, 'check_in': '03:36', 'check_out': '04:03'}];
let i = 0;
let marker = null;
let playing = true;
let speed = 1;
const progressBar = document.getElementById('progressBar');
document.getElementById('speedSlider').oninput = e => speed = parseFloat(e.target.value);
progressBar.oninput = e => { i = parseInt(e.target.value); updateCar(map); };
function play() { playing = true; moveCar(map); }
function pause() { playing = false; }
function isWaitingHere(lat, lng) {
  for (let j = 0; j < visits.length; j++) {
    const v = visits[j];
    const dist = Math.sqrt((v.lat - lat)**2 + (v.lng - lng)**2);
    if (dist < 0.0005) return { stop: v, index: j };
  }
  return null;
}
function updateCar(map) {
  const [lat, lng] = route[i];
  const res = isWaitingHere(lat, lng);
  const stop = res ? res.stop : null;
  const index = res ? res.index : null;
  const status = stop ? `Waiting at ${stop.shop}: ${stop.duration_min} min` : 'Moving...';
  parent.postMessage({ statusText: status, highlightIndex: index }, '*');
  if (!marker) {
    marker = L.marker([lat, lng], {
      icon: L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/870/870130.png',
        iconSize: [32, 32], iconAnchor: [16, 16]
      })
    }).addTo(map);
  } else {
    marker.setLatLng([lat, lng]);
  }
  if (stop) marker.bindPopup(status).openPopup();
  else marker.closePopup();
  progressBar.value = i;
}
function moveCar(map) {
  if (i >= route.length || !playing) return;
  updateCar(map);
  const [lat, lng] = route[i];
  const res = isWaitingHere(lat, lng);
  const stop = res ? res.stop : null;
  const stepTime = 60000 / route.length;
  const pauseMs = stop ? stop.duration_min * 1000 : stepTime / speed;
  i++;
  setTimeout(() => moveCar(map), pauseMs);
}
window.onload = function() {
  map = Object.values(window).find(v => v instanceof L.Map);
  setTimeout(() => moveCar(map), 1000);
};
</script>
